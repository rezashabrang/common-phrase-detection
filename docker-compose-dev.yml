version: "3.7"

services:
    phrase-counter:
        build:
            dockerfile: Dockerfile.dev
            context: .
        image: phrase-counter
        container_name: phrase-counter
        environment:
            MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
            MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
            MONGO_USERNAME: ${MONGO_USERNAME}
            MONGO_PASSWORD: ${MONGO_PASSWORD}
            MONGO_PHRASE_DB: ${MONGO_PHRASE_DB}
            MONGO_PHRASE_COL: ${MONGO_PHRASE_COL}
            MONGO_HOST: ${MONGO_HOST}
            MONGO_PORT: ${MONGO_PORT}
            API_KEY: ${API_KEY}
        volumes:
            - .:/app/
            - /app/.venv
        ports:
            - "8000:80"
    phrase-db:
        image: mongo
        container_name: phrase-db
        restart: always
        environment:
            MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
            MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
            MONGO_USERNAME: ${MONGO_USERNAME}
            MONGO_PASSWORD: ${MONGO_PASSWORD}
            MONGO_PHRASE_DB: ${MONGO_PHRASE_DB}
            MONGO_PHRASE_COL: ${MONGO_PHRASE_COL}
            MONGO_HOST: ${MONGO_HOST}
            MONGO_PORT: ${MONGO_PORT}
        ports:
            - 27017:27017
        volumes:
            - ./data/mongo:/data/db
        # command: mongosh -u ${MONGO_INITDB_ROOT_USERNAME} -p ${MONGO_INITDB_ROOT_PASSWORD} --authenticationDatabase admin
        # command: mongod --auth --port 27017


    adminer:
        image: dockette/adminer:mongo
        ports:
            - 8080:80
